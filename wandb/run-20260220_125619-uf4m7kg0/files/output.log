Training on tpu...
Available devices: [TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0), TpuDevice(id=2, process_index=0, coords=(0,1,0), core_on_chip=0), TpuDevice(id=3, process_index=0, coords=(1,1,0), core_on_chip=0), TpuDevice(id=4, process_index=0, coords=(0,2,0), core_on_chip=0), TpuDevice(id=5, process_index=0, coords=(1,2,0), core_on_chip=0), TpuDevice(id=6, process_index=0, coords=(0,3,0), core_on_chip=0), TpuDevice(id=7, process_index=0, coords=(1,3,0), core_on_chip=0)]
Using mesh: Mesh('data': 8, axis_types=(Auto,))
Traceback (most recent call last):
  File "/home/markus/nanogpt/train_gpt2.py", line 229, in <module>
    norm = optax.global_norm(accume_grad)
  File "/home/markus/.local/lib/python3.10/site-packages/optax/_src/linear_algebra.py", line 48, in global_norm
    return optax.tree.norm(updates)
  File "/home/markus/.local/lib/python3.10/site-packages/optax/tree_utils/_tree_math.py", line 292, in tree_norm
    squared_tree = jax.tree.map(_square, tree)
  File "/home/markus/.local/lib/python3.10/site-packages/jax/_src/tree.py", line 155, in map
    return tree_util.tree_map(f, tree, *rest, is_leaf=is_leaf)
  File "/home/markus/.local/lib/python3.10/site-packages/jax/_src/tree_util.py", line 362, in tree_map
    return treedef.unflatten(f(*xs) for xs in zip(*all_leaves))
  File "/home/markus/.local/lib/python3.10/site-packages/jax/_src/tree_util.py", line 362, in <genexpr>
    return treedef.unflatten(f(*xs) for xs in zip(*all_leaves))
  File "/home/markus/.local/lib/python3.10/site-packages/optax/tree_utils/_tree_math.py", line 275, in _square
    return jnp.square(leaf.real) + jnp.square(leaf.imag)
  File "/home/markus/.local/lib/python3.10/site-packages/jax/_src/numpy/array_methods.py", line 293, in _real_property
    return ufuncs.real(self)
KeyboardInterrupt
Traceback (most recent call last):
  File "/home/markus/nanogpt/train_gpt2.py", line 229, in <module>
    norm = optax.global_norm(accume_grad)
  File "/home/markus/.local/lib/python3.10/site-packages/optax/_src/linear_algebra.py", line 48, in global_norm
    return optax.tree.norm(updates)
  File "/home/markus/.local/lib/python3.10/site-packages/optax/tree_utils/_tree_math.py", line 292, in tree_norm
    squared_tree = jax.tree.map(_square, tree)
  File "/home/markus/.local/lib/python3.10/site-packages/jax/_src/tree.py", line 155, in map
    return tree_util.tree_map(f, tree, *rest, is_leaf=is_leaf)
  File "/home/markus/.local/lib/python3.10/site-packages/jax/_src/tree_util.py", line 362, in tree_map
    return treedef.unflatten(f(*xs) for xs in zip(*all_leaves))
  File "/home/markus/.local/lib/python3.10/site-packages/jax/_src/tree_util.py", line 362, in <genexpr>
    return treedef.unflatten(f(*xs) for xs in zip(*all_leaves))
  File "/home/markus/.local/lib/python3.10/site-packages/optax/tree_utils/_tree_math.py", line 275, in _square
    return jnp.square(leaf.real) + jnp.square(leaf.imag)
  File "/home/markus/.local/lib/python3.10/site-packages/jax/_src/numpy/array_methods.py", line 293, in _real_property
    return ufuncs.real(self)
KeyboardInterrupt
