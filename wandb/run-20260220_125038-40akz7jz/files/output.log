Training on tpu...
Available devices: [TpuDevice(id=0, process_index=0, coords=(0,0,0), core_on_chip=0), TpuDevice(id=1, process_index=0, coords=(1,0,0), core_on_chip=0), TpuDevice(id=2, process_index=0, coords=(0,1,0), core_on_chip=0), TpuDevice(id=3, process_index=0, coords=(1,1,0), core_on_chip=0), TpuDevice(id=4, process_index=0, coords=(0,2,0), core_on_chip=0), TpuDevice(id=5, process_index=0, coords=(1,2,0), core_on_chip=0), TpuDevice(id=6, process_index=0, coords=(0,3,0), core_on_chip=0), TpuDevice(id=7, process_index=0, coords=(1,3,0), core_on_chip=0)]
Using mesh: Mesh('data': 8, axis_types=(Auto,))
jax.errors.SimplifiedTraceback: For simplicity, JAX has removed its internal frames from the traceback of the following exception. Set JAX_TRACEBACK_FILTERING=off to include these.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/markus/nanogpt/train_gpt2.py", line 234, in <module>
    wandb.log({"val/loss": float(val_loss)}, step=step)
  File "/home/markus/nanogpt/train_gpt2.py", line 175, in eval_model
    val_loss = loss_fn(params, xb, yb, key=key)
jaxlib._jax.XlaRuntimeError: RESOURCE_EXHAUSTED: Allocation (size=52747567104) would exceed memory (size=33822867456) :: #allocation818 [shape = 'f32[256,1024,50304]{2,1,0:T(8,128)}', space=hbm, size = 0xffffffffffffffff, tag = 'output of fusion.831.remat@{1}'] :: <no-hlo-instruction>
jax.errors.SimplifiedTraceback: For simplicity, JAX has removed its internal frames from the traceback of the following exception. Set JAX_TRACEBACK_FILTERING=off to include these.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/markus/nanogpt/train_gpt2.py", line 234, in <module>
    wandb.log({"val/loss": float(val_loss)}, step=step)
  File "/home/markus/nanogpt/train_gpt2.py", line 175, in eval_model
    val_loss = loss_fn(params, xb, yb, key=key)
jaxlib._jax.XlaRuntimeError: RESOURCE_EXHAUSTED: Allocation (size=52747567104) would exceed memory (size=33822867456) :: #allocation818 [shape = 'f32[256,1024,50304]{2,1,0:T(8,128)}', space=hbm, size = 0xffffffffffffffff, tag = 'output of fusion.831.remat@{1}'] :: <no-hlo-instruction>
